<script lang="ts" setup>
import ArticleAsideItem from './article-aside-item.vue';
import { useActiveAnchor } from '../composables/use-active-anchor';

const { toc } = useContent();

const tocLinks = computed(() => toc.value?.links ?? []);

const container = ref();
const marker = ref();

useActiveAnchor(container, marker);
</script>

<template>
  <div class="flex grow-1 flex-col">
    <div ref="container">
      <div
        v-if="toc"
        class="relative border-l border-$pr-c-divider pl-4 text-size-[13px] font-500"
      >
        <div
          ref="marker"
          class="outline-marker absolute top-8 z-0 h-[18px] w-[1px] bg-$pr-c-brand opacity-0 -left-[1px]"
        />

        <div class="font-600 leading-7 tracking-[0.4px]">
          On this page
        </div>

        <nav aria-labelledby="doc-outline-aria-label">
          <span
            id="doc-outline-aria-label"
            class="sr-only"
          >
            Table of Contents for current page
          </span>

          <ArticleAsideItem
            root
            :toc-links="tocLinks"
          />
        </nav>
      </div>
    </div>
  </div>
</template>

<style lang="postcss" scoped>
  .outline-marker {
    transition: top 0.25s cubic-bezier(0, 1, 0.5, 1), background-color 0.5s, opacity 0.25s;
  }
</style>
